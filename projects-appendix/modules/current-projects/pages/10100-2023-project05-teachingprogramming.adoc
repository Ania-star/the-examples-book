= TDM 10100: Project 5 -- Fall 2023 
 
**Motivation:** `R` differs from other programing languages that _typically_  work best using vectorized functions and the _apply_ suite instead of using loops. 

[NOTE]
====
Apply Functions: are an alternative to loops. You can use *`apply()`* and its varients (i.e. mapply(), sapply(), lapply(), vapply(), rapply(), and tapply()...) to manuiplate peices of data from data.frames, lists, arrays, matrices in a repetative way. The *`apply()`* functions allow for flexiabilty in crossing data in multiple ways that a loop does not.
====

**Context:** We will focus in this project on efficient ways of processing data in `R`.

**Scope:** R, data.frames, recycling, factors, if/else, for loops, apply suite

.Learning Objectives
****
- Demonstrate the ability to use the `tapply` function.
****

Make sure to read about, and use the template found xref:templates.adoc[here], and the important information about projects submissions xref:submissions.adoc[here].

== Dataset(s)

The following questions will use the following dataset(s) in anvil:

/anvil/projects/tdm/data/election/escaped2020sample.txt

[NOTE]
====
A txt and csv file both sore information in plain text. *csv* files are _always_ separated by commas. In *txt* files the fields can be separated with commas, semicolons, or tab. 


To read in a txt file as a csv we simply add sep="|" (see code below)
[source,r]
----
 myDF <- read.csv("/anvil/projects/tdm/data/election/escaped2020sample.txt", sep="|")
----
====
=== `Data Understanding`

It is import to understand the data we are going to use in the project. The followings are examples to use `head` command to check and sense the selection data
[source, r]
head /anvil/projects/tdm/data/election/escaped2020sample.txt

Review the output of the statement, you may find out the reason why the file use '|' as seperator instead of comma, there has a full name field using comma to seperate first name, last name etc. 

[source,r]
head(myDF)

Review the output of the statement, check the fields of the data set, do pay attention to the format of `TRANSACTION_DT`, which is set up in the `[month].[day].[year]` 

=== `lubridate` 

When working with dates, for example, to organize `TRANSACTION_DT` in chronological order, it is important to use tools specifically for this purpose (rather than using string manipulation), we can use `lubridate` package, an excellent package which hides away many common issues that occur when working with dates.

[source,r]
----
library(lubridate, warn.conflicts = FALSE)
myDF$newdates <-mdy(myDF$TRANSACTION_DT)
----
A new column `newdates` is created as `date` data type

Feel free to check out https://raw.githubusercontent.com/rstudio/cheatsheets/master/lubridate.pdf[the official cheatsheet] in case you'd like to learn more about the package.


=== `tapply`

*tapply()* helps us to compute statistical measures such as mean, median, minimum, maximum, sum, etc... for data that is split into groups. *tapply()* is most helpful when we need to break up a vector into groups, and compute a function on each of the groups.

[source, r]
tapply(myDF$TRANSACTION_AMT, myDF$newdates, sum)

* tapply function applies a function `sum` to `myDF$TRANSACTION_AMT`, group by `myDF$newdates` 
* Three inputs for tapply
** `myDF$TRANSACTION_AMT`: the data vector to work on 
** `myDF$newdates`: the weay to break the data into groups
** `sum`: the function to apply on each piece of data

[WARNING]
====
Sometimes you may encounter that 'tapply' running interminably, e.g. not finish even after a few minutes; you may use the following steps to fix it

* Close the current Jupyter Notebook, back to Anvil homepage, click Clusters - '>Anvil shell Access'
* An Anvil shell window will open, after the $ prompt sign, input the following command then elick enter key 
    /anvil/projects/tdm/data/scripts/fixme.sh
* You will get "We hope that this fixes your issue. Good luck!"
* reopen a Jupytr Notebook session, make sure to put 5000 MB in memory field

You only run this "fix" when you have a cell running, but you are "stuck" on it
====
== Questions


=== Question 1 (1.5 pts)

[upperalpha]
.. Use the `year` function (from the `lubridate` library) on the column `TRANSACTION_DT` , to create a new column named `TRANSACTION_YR`.
.. Using `tapply`, add the values in the `TRANSACTION_AMT` column, according to the values in the `TRANSACTION_YR` column.
.. Plot the years on the x-axis and the `Summary Amount` on the y-axis.

=== Question 2 (1.5 pts)

[upperalpha]
.. From Question 1, you may notice the majority of the data collected is found in the years 2019-2020. Please create a new dataframe that only contains data for the dates in the range 01/01/2020-12/31/2020
.. Using `tapply`, get the amount summary in the `TRANSACTION_AMT` column group by different months 
.. Plot the months on the x-axis and the `Average Amount` on the y-axis.

=== Question 3 (2 pts)

Lets look at the donors and their donation amount

[upperalpha]

.. Create a new column that pastes together the `CTME_ID` and `Name`
.. Find the total donation amount for each `CTME_ID` and `Name` combination 


=== Question 4 (1.5 pts)

Lets look into the top donor from Question 3

[upperalpha]
.. Please find the donor with most donation amount. 
.. Use `tapply` to get the top donor's yearly donation summaries 
.. what is the average donation amounts for the top donor for different years?

=== Question 5 (1.5 pts)

[upperalpha]
.. Using a `barplot` or `dotchart`, show the total amount of donations group by states
.. What is the zipcode that donates the most money?
.. Plot something that you find interesting about the zipcode columns

Project 05 Assignment Checklist
====
* Jupyter Lab notebook with your code and comments for the assignment
    ** `firstname-lastname-project05.ipynb`.

* Submit files through Gradescope
====
[WARNING]
====
_Please_ make sure to double check that your submission is complete, and contains all of your code and output before submitting. If you are on a spotty internet connection, it is recommended to download your submission after submitting it to make sure what you _think_ you submitted, was what you _actually_ submitted.
                                                                                                                             
In addition, please review our xref:submissions.adoc[submission guidelines] before submitting your project.
====
