= TDM 10100: R Project 8 -- 2024

**Motivation:** We will learn about how user-defined functions work in R.

**Context:** Although R has lots of built-in functions, we can design our own functions too!

**Scope:** We start with some basic functions, just one line functions, to demonstrate how powerful they are.

.Learning Objectives:
****
- User-defined functions in R.
****

Make sure to read about, and use the template found xref:templates.adoc[here], and the important information about project submissions xref:submissions.adoc[here].

== Dataset(s)

This project will use the following dataset(s):

- `/anvil/projects/tdm/data/death_records/DeathRecords.csv`
- `/anvil/projects/tdm/data/8451/The_Complete_Journey_2_Master/5000_transactions.csv`
- `/anvil/projects/tdm/data/beer/reviews_sample.csv`
- `/anvil/projects/tdm/data/election/itcont1980.txt`
- `/anvil/projects/tdm/data/flights/subset/1990.csv`


== Questions

[IMPORTANT]
====
As before, please use the `seminar-r` kernel (not the `seminar` kernel).  You do not need to use the `%%R` cell magic.
====

[TIP]
====
If you session crashes when you read in the data (for instance, on question 2), you might want to try using 2 cores in your session instead of 1 core.
====



=== Question 1 (2 pts)

Consider this user-defined function, which makes a table that shows the percentages of values in each category:

`makeatable <- function(x) {prop.table(table(x, useNA="always"))}`

If we do something like this, with a column from a data frame:

`makeatable(myDF$mycolumn)`

Then it is the same as running this:

`prop.table(table(myDF$mycolumn, useNA="always"))`

In other words, `makeatable` is a user-defined function that makes a table, including all `NA` values, and expresses the result as percentages.  That is what the `prop.table` does here.

Now consider the DeathRecords data set:

`/anvil/projects/tdm/data/death_records/DeathRecords.csv`


a.  Try the function `makeatable` on the `Sex` column of the DeathRecords.

b.  Also try the function `makeatable` on the `MaritalStatus` column of the DeathRecords.


.Deliverables
====
- Use the `makeatable` function to display table of values from the `Sex` column of the DeathRecords.

- Use the `makeatable` function to display table of values from the `MaritalStatus` column of the DeathRecords.
====


=== Question 2 (2 pts)

In the grocery store file:

`/anvil/projects/tdm/data/8451/The_Complete_Journey_2_Master/5000_transactions.csv`

Use the `tapply` function to sum the values from the `SPEND` column, according to 8 categories, namely, according to whether the `YEAR` is 2016 or 2017, and according to whether the `STORE_R` value is `CENTRAL`, `EAST`, `SOUTH`, or `WEST`.


.Deliverables
====
- Show the sum of the values in the `SPEND` column according to the 8 possible pairs of `YEAR` and `STORE_R` values.
====

=== Question 3 (2 pts)

In this file of beer reviews `/anvil/projects/tdm/data/beer/reviews_sample.csv`

Use `tapply` to categorize the mean `score` values in each month and year pair.  Your `tapply` should output a table with years as the row labels and the months as the column labels.

.Deliverables
====
- Print a table displaying the mean `score` values for each month and year pair.
====


=== Question 4 (2 pts)

Read in the 1980 election data using:

[source, R]
----
library(data.table)
myDF <- fread("/anvil/projects/tdm/data/election/itcont1980.txt", quote="")
names(myDF) <- c("CMTE_ID", "AMNDT_IND", "RPT_TP", "TRANSACTION_PGI", "IMAGE_NUM", "TRANSACTION_TP", "ENTITY_TP", "NAME", "CITY", "STATE", "ZIP_CODE", "EMPLOYER", "OCCUPATION", "TRANSACTION_DT", "TRANSACTION_AMT", "OTHER_ID", "TRAN_ID", "FILE_NUM", "MEMO_CD", "MEMO_TEXT", "SUB_ID")
----

In this question, we do not care about the dollar amounts of the election donations.  In other words, do not pay any attention to the `TRANSACTION_AMT` column.  Only pay attention to the number of donations.  There is one donation per row in the data set.

a. Using the `subset` function to get a data frame that contains only the donations for which the `STATE` is `IN`.  From the `CITY` column of this `subset`, make a `table` of the number of occurrences of each `CITY`.  Sort the table and print the largest 41 entries.

b. Same question as part a, but this time, do not use the `subset` function.  Instead, consider the elements from the `CITY` column for which the `STATE` value is `IN`.  Amongst these restricted `CITY` values, make a `table` of the number of occurrences of each `CITY`.  Sort the table and print the largest 41 entries.  (Your result from question 4a and 4b should look the same, but using these two different methods.)

c. Find at least one strange thing about the top 41 entries in your result.

.Deliverables
====
- a. Using the `subset` function, give a `table` of the top 41 cities in Indiana, according to the number of donations from people in that city.
- b. Using indexing (not a `subset`), give a `table` of the top 41 cities in Indiana, according to the number of donations from people in that city.
- c. Find at least one strange thing about the top 41 entries in your result.
====


=== Question 5 (2 pts)

Consider the 1990 flight data:

`/anvil/projects/tdm/data/flights/subset/1990.csv`

The `DepDelay` values are given in minutes.  We will classify the number of flights according to how many hours that the flight was delayed.

Use the `cut` command to classify the number of flights in each of these categories:

`Flight departed early or on time, i.e., DepDelay is negative or 0.`

`Flight departed more than 0 but less than or equal to 60 minutes late.`

`Flight departed more than 60 but less than or equal to 120 minutes late.`

`Flight departed more than 120 but less than or equal to 180 minutes late.`

`Flight departed more than 180 but less than or equal to 240 minutes late.`

`Flight departed more than 240 but less than or equal to 300 minutes late.`

Etc., etc., and finally:

`Flight departed more than 1380 but less than or equal to 1440 minutes late.`

Make a `table` that shows the number of flights in each of these categories.

Use the `useNA="always"` option in the `table`, so that the number of flights without a known `DepDelay` is also given.

[NOTE]
====
In the `cut` command, the output will look nicer if you use the option `dig.lab = 4`.
====


.Deliverables
====
- Give the table described above, which classifies the number of flights according to the number of hours that the flights are delayed.
====


== Submitting your Work

You now are knowledgeable about a wide range of R functions.  Please continue to practice and to ask good questions~

.Items to submit
====
- firstname_lastname_project8.ipynb
====

[WARNING]
====
You _must_ double check your `.ipynb` after submitting it in gradescope. A _very_ common mistake is to assume that your `.ipynb` file has been rendered properly and contains your code, comments (in markdown or with hashtags), and code output, even though it may not. **Please** take the time to double check your work. See xref:submissions.adoc[the instructions on how to double check your submission].

You **will not** receive full credit if your `.ipynb` file submitted in Gradescope does not **show** all of the information you expect it to, including the output for each question result (i.e., the results of running your code), and also comments about your work on each question. Please ask a TA if you need help with this.  Please do not wait until Friday afternoon or evening to complete and submit your work.
====
